# 🧪 本地测试指南

## 📋 测试前准备

### 1. 确认开发服务器运行中
```bash
npm run dev
```
应该看到：
```
✓ Ready in XXXXs
- Local:   http://localhost:3000
```

### 2. 确认环境配置
检查 `.env.local` 包含：
- ✅ Supabase URL 和 Keys
- ✅ 合约地址（3个）
- ✅ Alchemy RPC URL
- ✅ Pinata JWT

### 3. 确认数据库已初始化
- ✅ 在 Supabase Dashboard 运行了 `schema.sql`
- ✅ 表已创建（users, works, collections, etc.）

### 4. 确认 MetaMask 配置
- ✅ 已安装 MetaMask
- ✅ 切换到 Sepolia 测试网
- ✅ 有测试 ETH（从水龙头获取）

---

## 🧪 测试流程

### 测试 1: 连接状态检查 ✅

#### 步骤：
1. 访问 http://localhost:3000/test-connection
2. 查看所有连接状态

#### 预期结果：
```
✅ Web3 钱包连接状态
✅ 智能合约连接状态  
✅ Supabase 数据库连接状态
✅ Pinata IPFS 配置状态
✅ 所有环境变量已设置
```

#### 如果失败：
- 检查 `.env.local` 配置
- 检查 Supabase 是否在线
- 检查网络连接

---

### 测试 2: 钱包连接 ✅

#### 步骤：
1. 访问 http://localhost:3000
2. 点击 "Connect Wallet" 按钮
3. MetaMask 弹窗出现
4. 点击 "连接"

#### 预期结果：
- MetaMask 成功连接
- 显示钱包地址（0x1234...5678）
- 进入注册表单（新用户）或主页（老用户）

#### 如果失败：
- 确认 MetaMask 已安装
- 确认在 Sepolia 测试网
- 刷新页面重试

---

### 测试 3: 新用户注册 ✅

#### 步骤：
1. 连接钱包（新地址）
2. 看到注册表单
3. 填写：
   - Display Name: "Test User"
   - Bio: "Testing the platform"
   - Skills: 选择几个技能
4. 点击 "Create Profile"

#### 预期结果：
- 显示加载动画
- 成功创建用户
- 自动进入主页
- 在 Supabase Dashboard 的 `users` 表中看到新记录

#### 检查数据库：
```sql
SELECT * FROM users ORDER BY created_at DESC LIMIT 1;
```
应该看到刚创建的用户。

#### 如果失败：
- 打开浏览器控制台查看错误
- 检查 Supabase 连接
- 检查 `useUser` Hook 是否正常工作

---

### 测试 4: 老用户登录 ✅

#### 步骤：
1. 断开钱包
2. 刷新页面
3. 用同一个钱包地址重新连接

#### 预期结果：
- 不显示注册表单
- 直接进入主页
- 显示用户名和信息

---

### 测试 5: 广场显示 ✅

#### 步骤：
1. 登录后默认在广场 tab
2. 查看作品列表

#### 预期结果：
- 如果数据库有作品：显示作品卡片
- 如果数据库为空：显示 "No works found"
- 搜索框可用
- 筛选标签可用

#### 测试搜索：
1. 在搜索框输入关键词
2. 作品列表应该过滤

#### 如果失败：
- 打开控制台查看错误
- 检查 `useWorks` Hook
- 检查 Supabase `works` 表

---

### 测试 6: 收藏功能 ⏳

#### 步骤：
1. 在广场找到一个作品
2. 点击 "Collect" 按钮
3. 选择文件夹（或创建新文件夹）
4. 点击 "Save to Collection"

#### 预期结果：
- 显示成功消息
- 作品保存到数据库
- 切换到 "Saved" tab 可以看到

#### 检查数据库：
```sql
SELECT * FROM collections ORDER BY saved_at DESC LIMIT 1;
```

#### 如果失败：
- 检查控制台错误
- 检查 `useCollections` Hook
- 检查用户是否已登录

---

### 测试 7: 收藏夹查看 ⏳

#### 步骤：
1. 点击 "Saved" tab
2. 查看收藏的作品

#### 预期结果：
- 显示按文件夹分组的作品
- 新用户：显示 4 个默认文件夹（空的）
- 老用户：显示之前收藏的作品
- 每个作品显示授权状态

#### 测试创建文件夹：
1. 点击 "New Folder"
2. 输入名称
3. 点击 "Create"
4. 新文件夹出现在列表中

---

### 测试 8: 授权状态显示 ⏳

#### 步骤：
1. 在收藏夹中查看作品
2. 检查右上角的状态徽章
3. 检查右下角的按钮

#### 预期结果（5种状态）：

**1. No Remix**
- 徽章：红色 "No Remix"
- 按钮：灰色 "No Remix"（禁用）

**2. None（未申请）**
- 徽章：无
- 按钮：蓝色 "Remix"

**3. Pending（审核中）**
- 徽章：黄色 "Under Review"
- 按钮：灰色 "Reviewing"（禁用）

**4. Approved（已批准）**
- 徽章：绿色 "Approved & Paid"
- 按钮：绿色 "Upload Work"

**5. Rejected（已拒绝）**
- 徽章：红色 "Rejected: Funds"
- 按钮：红色 "Retry"

---

### 测试 9: 个人资料 ⏳

#### 步骤：
1. 点击 "Profile" tab
2. 查看个人信息

#### 预期结果：
- 显示用户名
- 显示简介
- 显示技能标签
- 显示平台 ID（WW-XXXXXX）
- 显示余额（目前可能是 0）

---

## 🐛 调试技巧

### 1. 打开浏览器控制台
```
Chrome/Edge: F12 或 Cmd+Option+I (Mac)
Firefox: F12 或 Cmd+Option+K (Mac)
```

### 2. 查看网络请求
- 切换到 "Network" tab
- 查看 API 请求是否成功
- 检查返回的数据

### 3. 查看 React 组件状态
- 安装 React Developer Tools
- 查看组件的 props 和 state

### 4. 查看数据库
- 登录 Supabase Dashboard
- 进入 Table Editor
- 查看各个表的数据

### 5. 查看合约状态
- 访问 Sepolia Etherscan
- 输入合约地址
- 查看交易历史

---

## 📊 测试检查清单

### 基础功能
- [ ] 开发服务器运行正常
- [ ] 测试连接页面全部通过
- [ ] MetaMask 连接成功
- [ ] 新用户注册成功
- [ ] 老用户登录成功

### 核心功能
- [ ] 广场显示作品（或空状态）
- [ ] 搜索功能正常
- [ ] 收藏功能正常
- [ ] 收藏夹显示正常
- [ ] 文件夹创建正常

### 授权状态
- [ ] No Remix 状态显示正确
- [ ] None 状态显示正确
- [ ] Pending 状态显示正确
- [ ] Approved 状态显示正确
- [ ] Rejected 状态显示正确

### 个人资料
- [ ] 用户信息显示正确
- [ ] 平台 ID 显示
- [ ] 余额显示

---

## 🔧 常见问题

### Q1: 页面一直加载
**解决：**
- 检查控制台错误
- 检查 Supabase 连接
- 刷新页面

### Q2: 钱包连接失败
**解决：**
- 确认 MetaMask 已安装
- 切换到 Sepolia 测试网
- 刷新页面重试

### Q3: 数据库查询失败
**解决：**
- 检查 `.env.local` 中的 Supabase 配置
- 确认数据库 Schema 已运行
- 检查 Supabase 项目是否暂停

### Q4: 合约调用失败
**解决：**
- 确认合约地址正确
- 确认在 Sepolia 测试网
- 确认有足够的测试 ETH

### Q5: 图片不显示
**解决：**
- 检查 IPFS URL 是否正确
- 尝试访问 IPFS Gateway
- 检查网络连接

---

## 📝 测试数据准备

### 创建测试作品（在 Supabase）
```sql
INSERT INTO works (
  work_id, 
  creator_address, 
  title, 
  description, 
  image_url, 
  metadata_uri, 
  allow_remix, 
  is_remix
) VALUES (
  1,
  '0x1234567890123456789012345678901234567890',
  'Test Artwork',
  'This is a test artwork',
  'https://gateway.pinata.cloud/ipfs/QmTest...',
  'ipfs://QmTest...',
  true,
  false
);
```

### 创建测试收藏
```sql
-- 先获取用户 ID
SELECT id FROM users WHERE wallet_address = 'your_wallet_address';

-- 创建收藏
INSERT INTO collections (
  user_id,
  work_id,
  folder_id,
  note
) VALUES (
  1, -- 你的用户 ID
  1, -- 作品 ID
  1, -- 文件夹 ID
  'Test collection'
);
```

---

## 🎯 测试目标

### 短期目标（今天）
- [x] 确认所有连接正常
- [x] 测试用户登录/注册
- [x] 测试广场显示
- [ ] 测试收藏功能
- [ ] 测试收藏夹显示

### 中期目标（本周）
- [ ] 测试作品上传
- [ ] 测试授权申请
- [ ] 测试支付流程
- [ ] 测试个人资料

### 长期目标（下周）
- [ ] 测试 Tip 功能
- [ ] 测试 Withdraw 功能
- [ ] 测试创作谱系树
- [ ] 性能测试
- [ ] 安全测试

---

**准备好开始测试了吗？从测试连接页面开始！** 🚀

访问：http://localhost:3000/test-connection
