# WhichWitch - 去中心化创意作品平台

## 📋 项目概述

WhichWitch 是一个基于区块链的创意作品分享与二创平台，允许创作者上传作品、授权他人进行二次创作，并通过智能合约自动管理版权和收益分配。

**核心价值：**
- 🎨 保护原创作品版权
- 🔄 支持合法的二次创作（Remix）
- 💰 自动化的收益分配
- 🌐 去中心化存储，永久保存

---

## 🏗️ 系统架构

```
┌─────────────────────────────────────────────────────────────────┐
│                         用户界面层 (Frontend)                      │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │  作品广场    │  │  上传作品    │  │  个人中心    │          │
│  │  (Gallery)   │  │  (Upload)    │  │  (Profile)   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│         │                  │                  │                  │
│         └──────────────────┴──────────────────┘                  │
│                            │                                     │
│                    Next.js 14 + React                            │
│                    Tailwind CSS + shadcn/ui                      │
└─────────────────────────────┬───────────────────────────────────┘
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌───────────────┐    ┌────────────────┐    ┌──────────────┐
│  区块链层      │    │  存储层         │    │  数据库层     │
│  (Blockchain) │    │  (Storage)      │    │  (Database)  │
├───────────────┤    ├────────────────┤    ├──────────────┤
│               │    │                │    │              │
│ 智能合约      │    │  Pinata IPFS   │    │  Supabase    │
│ (Solidity)    │    │                │    │  PostgreSQL  │
│               │    │  - 图片存储    │    │              │
│ - 作品注册    │    │  - 元数据存储  │    │  - 用户信息  │
│ - 版权管理    │    │  - 永久保存    │    │  - 作品元数据│
│ - 授权控制    │    │                │    │  - 收藏关系  │
│ - 收益分配    │    │                │    │  - 授权记录  │
│               │    │                │    │              │
│ Sepolia 测试网│    │                │    │              │
└───────────────┘    └────────────────┘    └──────────────┘
        │                     │                     │
        └─────────────────────┴─────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │   基础设施层       │
                    ├───────────────────┤
                    │ - Alchemy RPC     │
                    │ - Vercel 部署     │
                    │ - RainbowKit 钱包 │
                    └───────────────────┘
```

---

## 🔧 技术栈详解

### 前端技术
| 技术 | 版本 | 用途 |
|------|------|------|
| **Next.js** | 14.x | React 框架，支持 SSR/SSG |
| **React** | 18.x | UI 组件库 |
| **TypeScript** | 5.x | 类型安全 |
| **Tailwind CSS** | 3.x | 样式框架 |
| **shadcn/ui** | Latest | UI 组件库 |
| **RainbowKit** | 2.x | 钱包连接 |
| **wagmi** | 2.x | 以太坊交互 |
| **viem** | 2.x | 以太坊工具库 |

### 区块链技术
| 技术 | 说明 |
|------|------|
| **Solidity** | 智能合约开发语言 |
| **Ethereum Sepolia** | 测试网络 |
| **Alchemy** | RPC 节点提供商 |
| **ERC-721** | NFT 标准（可扩展） |

### 后端服务
| 服务 | 用途 |
|------|------|
| **Supabase** | PostgreSQL 数据库 + API |
| **Pinata** | IPFS 存储服务 |
| **Next.js API Routes** | 服务端 API |

### 部署平台
| 平台 | 用途 |
|------|------|
| **Vercel** | 前端部署 + Serverless Functions |
| **GitHub** | 代码托管 + CI/CD |

---

## 📊 数据流程

### 1️⃣ 作品上传流程

```
用户选择图片
    │
    ▼
填写作品信息
(标题、描述、故事、材料、标签)
    │
    ▼
连接钱包
    │
    ▼
上传图片到 Pinata IPFS ────────┐
    │                          │
    ▼                          │
生成元数据 JSON                 │
    │                          │
    ▼                          │
上传元数据到 IPFS ──────────────┤
    │                          │
    ▼                          │
调用智能合约注册作品            │
(存储 IPFS Hash)               │
    │                          │
    ▼                          │
获取作品 ID                     │
    │                          │
    ▼                          │
保存到 Supabase 数据库 ◄────────┘
(链下元数据 + 索引)
    │
    ▼
上传完成 ✓
```

### 2️⃣ 二创授权流程

```
用户浏览作品
    │
    ▼
选择想要二创的作品
    │
    ▼
检查是否允许二创
    │
    ├─ 不允许 → 显示提示
    │
    └─ 允许
        │
        ▼
    申请授权
        │
        ▼
    支付授权费用
    (调用智能合约)
        │
        ▼
    授权成功
        │
        ▼
    可以创建衍生作品
```

### 3️⃣ 收益分配流程

```
用户购买/使用作品
    │
    ▼
智能合约接收付款
    │
    ▼
自动计算分配比例
    │
    ├─ 原创作者 (70%)
    │
    ├─ 平台 (10%)
    │
    └─ 其他参与者 (20%)
        │
        ▼
    自动转账到各方钱包
```

---

## 🗄️ 数据库设计

### 核心表结构

#### 1. users (用户表)
```sql
- id: 主键
- wallet_address: 钱包地址 (唯一)
- platform_id: 平台 ID (WW-XXXXXX)
- name: 用户名
- bio: 个人简介
- skills: 技能标签
- avatar_url: 头像 URL
- created_at: 创建时间
```

#### 2. works (作品表)
```sql
- id: 主键
- work_id: 链上作品 ID (唯一)
- creator_address: 创作者地址
- title: 作品标题
- description: 作品描述
- story: 创作故事
- image_url: 图片 IPFS URL
- metadata_uri: 元数据 IPFS URI
- material: 材料标签
- tags: 分类标签
- allow_remix: 是否允许二创
- license_fee: 授权费用
- parent_work_id: 父作品 ID (衍生作品)
- is_remix: 是否为衍生作品
- created_at: 创建时间
```

#### 3. folders (收藏夹表)
```sql
- id: 主键
- user_id: 用户 ID
- name: 文件夹名称
- description: 描述
- is_default: 是否默认文件夹
- created_at: 创建时间
```

#### 4. collections (收藏关系表)
```sql
- id: 主键
- user_id: 用户 ID
- work_id: 作品 ID
- folder_id: 文件夹 ID
- note: 收藏备注
- saved_at: 收藏时间
```

#### 5. authorization_requests (授权申请表)
```sql
- id: 主键
- user_address: 申请者地址
- work_id: 作品 ID
- status: 状态 (pending/approved/rejected/failed)
- tx_hash: 交易哈希
- error_message: 错误信息
- created_at: 创建时间
```

#### 6. work_stats (作品统计表)
```sql
- work_id: 作品 ID (主键)
- view_count: 浏览次数
- like_count: 点赞数
- remix_count: 直接衍生数
- total_derivatives: 总衍生数
- last_updated: 更新时间
```

---

## 🔐 智能合约架构

### 合约模块

#### 1. CreationContract (作品创建合约)
**地址:** `0xB9365df57B3250cC6e4B9b3efDeE9871020b68cF`

**功能:**
- `registerWork()` - 注册新作品
- `getWork()` - 获取作品信息
- `getWorksByCreator()` - 获取创作者的所有作品
- `updateWorkMetadata()` - 更新作品元数据

**事件:**
- `WorkRegistered` - 作品注册成功
- `MetadataUpdated` - 元数据更新

#### 2. PaymentContract (支付合约)
**地址:** `0xE9e700df0e448F5DebE55A8B153aebf8988db0c8`

**功能:**
- `processPayment()` - 处理支付
- `distributeRevenue()` - 分配收益
- `withdrawFunds()` - 提取资金

**事件:**
- `PaymentProcessed` - 支付完成
- `RevenueDistributed` - 收益分配

#### 3. AuthorizationContract (授权合约)
**地址:** `0x182AF7db7B2928455900595506D94b26E173aeA1`

**功能:**
- `requestAuthorization()` - 申请授权
- `approveAuthorization()` - 批准授权
- `checkAuthorization()` - 检查授权状态

**事件:**
- `AuthorizationRequested` - 授权申请
- `AuthorizationApproved` - 授权批准

---

## 🌐 部署架构

```
┌─────────────────────────────────────────────────┐
│              GitHub Repository                   │
│         (代码托管 + 版本控制)                     │
└────────────────┬────────────────────────────────┘
                 │
                 │ Git Push
                 │
                 ▼
┌─────────────────────────────────────────────────┐
│              Vercel Platform                     │
│                                                  │
│  ┌──────────────────────────────────────────┐  │
│  │  自动构建 (CI/CD)                         │  │
│  │  - npm install                            │  │
│  │  - npm run build                          │  │
│  │  - 优化资源                               │  │
│  └──────────────────────────────────────────┘  │
│                     │                            │
│                     ▼                            │
│  ┌──────────────────────────────────────────┐  │
│  │  全球 CDN 分发                            │  │
│  │  - 静态资源缓存                           │  │
│  │  - 边缘节点加速                           │  │
│  └──────────────────────────────────────────┘  │
│                     │                            │
│                     ▼                            │
│  ┌──────────────────────────────────────────┐  │
│  │  Serverless Functions                     │  │
│  │  - API Routes                             │  │
│  │  - 按需执行                               │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
                     │
                     ▼
              ┌──────────┐
              │  用户访问 │
              └──────────┘
```

---

## 🔒 安全措施

### 智能合约安全
- ✅ 使用 OpenZeppelin 标准库
- ✅ 访问控制 (Ownable, AccessControl)
- ✅ 重入攻击防护 (ReentrancyGuard)
- ✅ 整数溢出保护 (Solidity 0.8+)
- ✅ 事件日志记录

### 数据安全
- ✅ 环境变量隔离
- ✅ Service Role Key 仅在服务端使用
- ✅ API 路由权限控制
- ✅ 数据库 RLS (Row Level Security)

### 前端安全
- ✅ XSS 防护
- ✅ CSRF 防护
- ✅ 内容安全策略 (CSP)
- ✅ HTTPS 强制

---

## 📈 性能优化

### 前端优化
- ⚡ Next.js 静态生成 (SSG)
- ⚡ 图片懒加载
- ⚡ 代码分割 (Code Splitting)
- ⚡ CDN 加速
- ⚡ 浏览器缓存

### 数据库优化
- 🚀 索引优化 (wallet_address, work_id)
- 🚀 查询缓存
- 🚀 连接池管理
- 🚀 视图预计算 (work_details)

### 区块链优化
- 💨 批量操作
- 💨 Gas 优化
- 💨 事件监听代替轮询
- 💨 链下数据缓存

---

## 🎯 核心功能

### 已实现功能 ✅

1. **用户管理**
   - 钱包连接 (MetaMask, WalletConnect 等)
   - 用户注册与资料管理
   - 平台 ID 生成

2. **作品管理**
   - 作品上传 (图片 + 元数据)
   - IPFS 永久存储
   - 智能合约注册
   - 作品浏览与搜索
   - 作品详情展示

3. **收藏功能**
   - 创建收藏夹
   - 收藏作品
   - 分类管理

4. **授权系统**
   - 二创授权申请
   - 授权状态追踪
   - 授权费用支付

### 规划功能 🚧

1. **社交功能**
   - 关注创作者
   - 评论与点赞
   - 作品分享

2. **交易市场**
   - 作品买卖
   - 拍卖功能
   - 报价系统

3. **创作工具**
   - 在线编辑器
   - 模板库
   - AI 辅助创作

4. **数据分析**
   - 创作者仪表板
   - 收益统计
   - 流量分析

---

## 📱 用户界面

### 主要页面

1. **首页 (Home)**
   - 精选作品展示
   - 分类导航
   - 搜索功能

2. **作品广场 (Gallery)**
   - 瀑布流布局
   - 筛选与排序
   - 无限滚动加载

3. **上传页面 (Upload)**
   - 拖拽上传
   - 表单填写
   - 实时预览

4. **个人中心 (Profile)**
   - 我的作品
   - 我的收藏
   - 收益统计
   - 设置管理

5. **作品详情 (Work Detail)**
   - 高清预览
   - 创作信息
   - 衍生作品树
   - 操作按钮

---

## 🌟 产品优势

### 技术优势
- 🔗 **区块链技术** - 不可篡改的版权记录
- 💾 **IPFS 存储** - 去中心化，永久保存
- ⚡ **现代技术栈** - 高性能，易维护
- 🔐 **安全可靠** - 多层安全防护

### 用户优势
- 🎨 **保护原创** - 链上版权证明
- 💰 **收益透明** - 智能合约自动分配
- 🔄 **合法二创** - 授权机制清晰
- 🌐 **全球访问** - 去中心化存储

### 商业优势
- 📈 **可扩展** - 模块化架构
- 💵 **低成本** - Serverless 架构
- 🚀 **快速迭代** - CI/CD 自动化
- 🌍 **全球部署** - CDN 加速

---

## 📞 技术支持

### 在线资源
- **GitHub**: [项目仓库](https://github.com/iqnuxul/whichWitch)
- **文档**: 项目根目录下的 Markdown 文档
- **演示**: [Vercel 部署地址]

### 联系方式
- **技术咨询**: 通过 GitHub Issues
- **商务合作**: [联系邮箱]

---

## 📄 许可证

本项目采用 MIT 许可证。

---

**最后更新**: 2024年1月
**版本**: v1.0.0
**状态**: ✅ 生产就绪
